## 项目结构

Multi-repo`和`Mono-repo

- `Multi-repo`每个库有自己独立的仓库，逻辑清晰，相对应的，协同管理会更繁琐。
- `Mono-repo`可以很方便的协同管理不同独立的库的生命周期，相对应的，会有更高的操作复杂度。

| **维度**       | **Mono-repo**                                    | **Multi-repo**                                 |
| -------------- | ------------------------------------------------ | ---------------------------------------------- |
| **代码管理**   | 所有项目/模块在一个仓库中                        | 每个项目独立仓库                               |
| **协作效率**   | ✅ 跨项目代码共享、原子提交（一次提交修改多模块） | ❌ 跨仓库修改需协调，易导致集成问题             |
| **依赖管理**   | 统一依赖版本，避免“依赖地狱”                     | 依赖版本易冲突，需手动同步（如重复安装相同库） |
| **权限控制**   | ❌ 需精细化管理子目录权限（复杂度高）             | ✅ 按仓库独立控制权限（适合敏感项目）           |
| **性能与规模** | ❌ 仓库过大时克隆/构建慢（需优化工具链）          | ✅ 独立仓库轻量，构建更快                       |
| **适用场景**   | 多模块强关联项目（如微前端、UI 组件库）          | 独立服务/团队边界清晰（如微服务架构）          |

------

### 

#### Monorepo优点

https://juejin.cn/post/6944877410827370504

专注于大型项目的开发效率与代码质量。

##### 1.代码复用

一些基础的组件、工具函数，或者一些配置可以统一配置，团队协作也更加容易

##### 2.版本管理

**版本隔离**：每个仓库可独立管理依赖版本，无需强制与其他仓库保持一致。

**精细化依赖访问控制**：敏感依赖（如内部工具库）可限制在特定仓库中，仅授权团队可修改或发布新版本，降低代码泄露风

##### 3.项目基建

各个项目的工作流是割裂的，因此每个项目需要单独配置开发环境、配置 CI 流程、配置部署发布流程等等，甚至每个项目都有自己单独的一套脚手架工具。



简单工具：

[pnpm workspaces](https://pnpm.io/workspaces)



### 定义开发规范



#### 代码规范：Eslint

```
pnpm i -D -w @typescript-eslint/eslint-plugin 
```

`.eslintrc.json`配置

```json
{
   "env": {
      "browser": true,  // 支持浏览器全局变量（如 window）
      "es2021": true,    // 支持 ES2021 语法
      "node": true       // 支持 Node.js 全局变量（如 require）
   },
	"extends": [
      "eslint:recommended",                   // ESLint 官方推荐规则
      "plugin:@typescript-eslint/recommended", // TypeScript 类型检查规则
      "prettier",                             // 关闭与 Prettier 冲突的规则
      "plugin:prettier/recommended"           // 集成 Prettier 格式化
	],
   "parser": "@typescript-eslint/parser",  //	指定代码解析器
   "parserOptions": {		//	解析器配置
    "ecmaVersion": "latest",	// 启用最新的 ES 语法支持
    "sourceType": "module"	// 使用 ES 模块规范
   },
   "plugins": ["@typescript-eslint", "prettier"],
   "rules": {
      "prettier/prettier": "error",           // Prettier 格式问题视为错误
      "no-case-declarations": "off",          // 允许在 case 语句中声明变量
      "no-constant-condition": "off",         // 允许常量条件判断（如 while(true)）
      "@typescript-eslint/ban-ts-comment": "off" // 允许使用 @ts-ignore 等注释
   }
}
```



最新扁平化文件

```

import js from '@eslint/js';
import typescriptEslint from '@typescript-eslint/eslint-plugin';
import typescriptParser from '@typescript-eslint/parser';
import prettier from 'eslint-plugin-prettier';
import prettierConfig from 'eslint-config-prettier';

// 导出 ESLint 配置数组
export default [
	js.configs.recommended,    // 应用基础 ESLint 推荐配置规则	

	// TypeScript 配置部分
	{
		files: ['**/*.ts', '**/*.tsx'],
		// 语言选项配置
		languageOptions: {
			parser: typescriptParser,	// 使用 TypeScript 解析器
			ecmaVersion: 'latest',	// 使用最新的 ECMAScript 版本
			sourceType: 'module',		// 使用模块化源码类型
		},
		// 注册插件
		plugins: {
			'@typescript-eslint': typescriptEslint	// 注册 TypeScript ESLint 插件
		},
		// 规则配置
		rules: {
			...typescriptEslint.configs.recommended.rules,	// 展开 TypeScript 推荐规则
			'@typescript-eslint/ban-ts-comment': 'off'	// 关闭禁止使用 @ts-comment 的规则
		}
	},

	// 全局环境变量配置部分
	{
		// 指定该配置适用于所有 JavaScript 和 TypeScript 文件
		files: ['**/*.js', '**/*.ts', '**/*.tsx'],
		languageOptions: {
			globals: {
				browser: 'readonly',
				es2021: 'readonly',
				node: 'readonly'
			}
		}
	},

	// Prettier 集成配置部分
	{
		// 指定该配置适用于所有 JavaScript 和 TypeScript 文件
		files: ['**/*.js', '**/*.ts', '**/*.tsx'],
		plugins: {
			// 注册 Prettier 插件
			prettier: prettier
		},
		// 规则配置
		rules: {
			...prettierConfig.rules,	// 展开并应用禁用与 Prettier 冲突的规则
			'prettier/prettier': 'error',	// 将 Prettier 错误作为 ESLint 错误处理
			'no-case-declarations': 'off',	// 关闭 case 声明检查规则
			'no-constant-condition': 'off'				// 关闭常量条件检查规则
		}
	}
];

```

**`@typescript-eslint/parser`** :  TypeScript 语法解析器

**`@typescript-eslint/eslint-plugin`**  : TypeScript 语法规则集



为`lint`增加对应的执行脚本，并验证效果：

```
"lint": "eslint --ext .js .ts,.jsx,.tsx --fix --quiet ./packages"
```





> ##### 注：解决ESLint 中与 Prettier 冲突

**`eslint-config-prettier`**  :  覆盖`ESLint`本身的规则配置，关闭 ESLint 中与 Prettier 冲突的规则

**`eslint-plugin-prettier`**  :  将 Prettier 作为 ESLint 规则运行

```json
{
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint", "prettier"],
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:prettier/recommended" // 集成 Prettier 并关闭冲突规则
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error", // TS 专属规则
    "prettier/prettier": "error" // 启用 Prettier 格式化检查
  }
}
```





#### 代码风格：Prettier

新建`.prettierrc.json`配置文件，添加配置：

```
{
  "printWidth": 80,       // 单行最大长度（超长自动换行）
  "tabWidth": 2,          // 缩进空格数
  "useTabs": true,        // 使用制表符而非空格缩进
  "singleQuote": true,    // 使用单引号（JSX 除外）
  "semi": true,           // 语句末尾加分号
  "trailingComma": "none",// 多行结构不加末尾逗号（如对象、数组）
  "bracketSpacing": true  // 对象花括号内加空格（如 { a: 1 }）
}
```











### commit规范检查



#### husky

用于拦截`commit`命令，初始化`husky`：

```bash
npx husky init  # 创建 .husky 目录及基础钩子
```

将刚才实现的格式化命令`pnpm lint`纳入`commit`时`husky`将执行的脚本 或者 使用使用[lint-staged](https://github.com/okonet/lint-staged)，实现只对暂存区代码进行检查

.husky/pre-commit

```bash
#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

pnpm lint

// or

npx lint-staged

```



考虑使用[lint-staged](https://github.com/okonet/lint-staged)，实现只对暂存区代码进行检查

```json
{
  "lint-staged": {
    "*.{js,ts,jsx,tsx}": [
      "eslint --fix --quiet",  // 自动修复可修复的问题
      "git add"                // 重新暂存修复后的文件
    ]
  }
}
```



还可以在`setting`中设置为保存后自动执行





####  **Commitlint 配置和工作流**

通过[commitlint](https://github.com/conventional-changelog/commitlint)对`git`提交信息进行检查

```powershell
pnpm i commitlint @commitlint/cli @commitlint/config-conventional -D -w
```

**Commitlint**  ： 校验 Git 提交信息是否符合规范

**@commitlint/cli** ：  Commitlint 的命令行工具

**@commitlint/config-conventional**  ： 预置的提交规范配置（基于 Conventional Commits）



配置文件`.commitlintrc.js`：

```js
export default {
	extends: ['@commitlint/config-conventional']
};
```



集成到`husky`中：

.husky/commit-msg

```powershell
#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

npx --no -- commitlint --edit "$1"
```



添加

配置`tsconfig.json`

```json
{
 "compileOnSave": true,
 "compilerOptions": {
  "target": "ESNext",
  "useDefineForClassFields": true,
  "module": "ESNext",
  "lib": ["ESNext", "DOM"],
  "moduleResolution": "Node",
  "strict": true,
  "sourceMap": true,
  "resolveJsonModule": true,
  "isolatedModules": true,
  "esModuleInterop": true,
  "noEmit": true,
  "noUnusedLocals": true,
  "noUnusedParameters": true,
  "noImplicitReturns": false,
  "skipLibCheck": true,
  "baseUrl": "./packages"
 }
}
```



### 选择打包工具

比较不同打包工具的区别 [参考资料：Overview | Tooling.Report](https://bundlers.tooling.report/)我们要开发的项目的特点：

- 是库，而不是业务项目
- 希望工具尽可能简洁、打包产物可读性高
- 原生支持`ESM`

所以选择`rollup`，安装：